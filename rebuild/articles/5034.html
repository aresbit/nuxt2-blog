<h1 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23)Rusts%20Module%20System%20Explained"></sup><a class="header-link" href="#id-%5B%5D(%23)Rusts%20Module%20System%20Explained"></a><p><a class="header-link" href="#id-%5B%5D(%23)Rusts%20Module%20System%20Explained"></a><a href="#"></a>Rusts Module System Explained</p></h1><h1 class="cyxy-trs-source cyxy-trs-target" contenteditable="true">ç”Ÿé”ˆæ¨¡å—ç³»ç»Ÿè§£é‡Š</h1>
<p class="cyxy-trs-source cyxy-trs-source-ted">Table of Contents</p><p class="cyxy-trs-source cyxy-trs-target">ç›®å½•</p>
<ul>
<li><a href="#why-do-modules-exist" class="cyxy-trs-source">Why do modules exist?<font class="cyxy-trs-target"> æ¨¡å—ä¸ºä»€ä¹ˆå­˜åœ¨ï¼Ÿ</font></a></li>
<li><a href="#the-module-tree" class="cyxy-trs-source">The module tree<font class="cyxy-trs-target"> æ¨¡å—æ ‘</font></a><ul>
<li><a href="#submodules" class="cyxy-trs-source">Submodules<font class="cyxy-trs-target"> å­æ¨¡ç»„</font></a></li>
<li><a href="#an-example" class="cyxy-trs-source">An example<font class="cyxy-trs-target"> ä¸€ä¸ªä¾‹å­</font></a></li></ul></li>
<li><a href="#items-and-paths" class="cyxy-trs-source">Items and paths<font class="cyxy-trs-target"> é¡¹ç›®å’Œè·¯å¾„</font></a></li>
<li><a href="#visibility" class="cyxy-trs-source">Visibility<font class="cyxy-trs-target"> èƒ½è§åº¦</font></a><ul>
<li><a href="#encapsulation" class="cyxy-trs-source">Encapsulation<font class="cyxy-trs-target"> å°è£…</font></a></li>
<li><a href="#fine-grained-visibility" class="cyxy-trs-source">Fine-grained visibility<font class="cyxy-trs-target"> ç»†ç²’åº¦çš„å¯è§æ€§</font></a></li>
<li><a href="#visibilities-overview" class="cyxy-trs-source">Visibilities overview<font class="cyxy-trs-target"> å¯è§†æ€§æ¦‚è¿°</font></a></li></ul></li>
<li><a href="#exports" class="cyxy-trs-source">Exports<font class="cyxy-trs-target"> å‡ºå£</font></a></li>
<li><a href="#common-pitfalls" class="cyxy-trs-source">Common pitfalls<font class="cyxy-trs-target"> å¸¸è§çš„é™·é˜±</font></a></li>
<li><a href="#special-cases" class="cyxy-trs-source">Special cases<font class="cyxy-trs-target"> ç‰¹æ®Šæƒ…å†µ</font></a><ul>
<li><a href="#enum-variants-and-fields" class="cyxy-trs-source">Enum variants and fields<font class="cyxy-trs-target"> å˜ä½“å’Œå­—æ®µ</font></a></li>
<li><a href="#macros" class="cyxy-trs-source">Macros<font class="cyxy-trs-target"> å®</font></a></li></ul></li>
<li><a href="#why-are-modules-declared-explicitly" class="cyxy-trs-source">Why are modules declared explicitly?<font class="cyxy-trs-target"> ä¸ºä»€ä¹ˆè¦æ˜¾å¼å£°æ˜æ¨¡å—ï¼Ÿ</font></a></li>
<li><a href="#fin" class="cyxy-trs-source">Fin<font class="cyxy-trs-target"> èŠ¬</font></a></li>
</ul>
<p class="cyxy-trs-source cyxy-trs-source-ted">The Rust programming language can be confusing for beginners, and the module system is one part that causes frustration particularly often. There are <wdautohl-customtag style="font-weight:bold;color:blue;font-size:inherit;display:inline;" id="wdautohl_id_2" class="wdautohl_cXVpdGUgYSBmZXc_">quite a few</wdautohl-customtag> blog posts out there trying to explain the module system in a simple way, but I often have the feeling that they over-simplify things. So hereâ€™s my takeâ€”â€‹a more detailed explanation of the module system.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">Rust ç¼–ç¨‹è¯­è¨€å¯¹äºåˆå­¦è€…æ¥è¯´å¯èƒ½æ˜¯æ··ä¹±çš„ï¼Œè€Œä¸”æ¨¡å—ç³»ç»Ÿæ˜¯ç‰¹åˆ«ç»å¸¸å¼•èµ·æŒ«æŠ˜çš„ä¸€éƒ¨åˆ†ã€‚æœ‰ç›¸å½“å¤šçš„åšå®¢æ–‡ç« è¯•å›¾ç”¨ä¸€ç§ç®€å•çš„æ–¹å¼æ¥è§£é‡Šæ¨¡å—ç³»ç»Ÿï¼Œä½†æ˜¯æˆ‘ç»å¸¸æ„Ÿè§‰ä»–ä»¬æŠŠäº‹æƒ…è¿‡äºç®€å•åŒ–äº†ã€‚ä¸‹é¢æ˜¯æˆ‘å¯¹è¿™ä¸ªæ¨¡å—ç³»ç»Ÿçš„ä¸€ä¸ªæ›´è¯¦ç»†çš„è§£é‡Šã€‚</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">This post assumes that you can write at least a â€œhello worldâ€ Rust program. Itâ€™s a rather long read, so get comfortable, maybe with a cup of tea, hot chocolate, or whatever your heart desires ğŸ˜Š</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">è¿™ç¯‡æ–‡ç« å‡è®¾ä½ è‡³å°‘å¯ä»¥ç¼–å†™ä¸€ä¸ªâ€œ hello worldâ€Rust ç¨‹åºã€‚è¿™æ˜¯ä¸€ä¸ªç›¸å½“é•¿çš„é˜…è¯»ï¼Œæ‰€ä»¥èˆ’é€‚ï¼Œä¹Ÿè®¸ä¸€æ¯èŒ¶ï¼Œçƒ­å·§å…‹åŠ›ï¼Œæˆ–ä»»ä½•ä½ å¿ƒä¸­æƒ³è¦çš„</p>
<h2 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23why-do-modules-exist)Why%20do%20modules%20exist%3F"></sup><a class="header-link" href="#id-%5B%5D(%23why-do-modules-exist)Why%20do%20modules%20exist%3F"></a><p><a class="header-link" href="#id-%5B%5D(%23why-do-modules-exist)Why%20do%20modules%20exist%3F"></a><a href="#why-do-modules-exist"></a>Why do modules exist?</p></h2><h2 class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æ¨¡å—ä¸ºä»€ä¹ˆå­˜åœ¨ï¼Ÿ</h2>
<p class="cyxy-trs-source cyxy-trs-source-ted">Modules give your code <em>structure</em>: Dividing your code into modules is like dividing your house into several rooms: Each room has a different purpose, and rooms can be locked for privacy.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æ¨¡å—èµ‹äºˆä½ çš„ä»£ç ç»“æ„: å°†ä½ çš„ä»£ç åˆ’åˆ†ä¸ºæ¨¡å—å°±åƒå°†ä½ çš„æˆ¿å­åˆ’åˆ†ä¸ºå‡ ä¸ªæˆ¿é—´: æ¯ä¸ªæˆ¿é—´éƒ½æœ‰ä¸åŒçš„ç”¨é€”ï¼Œè€Œä¸”ä¸ºäº†ä¿æŠ¤éšç§ï¼Œæˆ¿é—´å¯ä»¥ä¸Šé”ã€‚</p>
<h2 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23the-module-tree)The%20module%20tree"></sup><a class="header-link" href="#id-%5B%5D(%23the-module-tree)The%20module%20tree"></a><p><a class="header-link" href="#id-%5B%5D(%23the-module-tree)The%20module%20tree"></a><a href="#the-module-tree"></a>The module tree</p></h2><h2 class="cyxy-trs-source cyxy-trs-target">æ¨¡å—æ ‘</h2>
<p class="cyxy-trs-source cyxy-trs-source-ted">Modules are structured in a <em>hierarchy</em>, the module tree, which is similar to the file tree of the source files. There are two kinds of modules: <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_3" class="wdautohl_aW5saW5l">Inline</wdautohl-customtag> modules and â€œnormalâ€ modules:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æ¨¡å—ä»¥å±‚æ¬¡ç»“æ„(å³æ¨¡å—æ ‘)ç»“æ„åŒ–ï¼Œè¿™ä¸æºæ–‡ä»¶çš„æ–‡ä»¶æ ‘ç±»ä¼¼ã€‚æœ‰ä¸¤ç§æ¨¡å—: å†…è”æ¨¡å—å’Œâ€œæ™®é€šâ€æ¨¡å—:</p>
<pre><small></small><div></div><code class="hljs language-gams"><span class="hljs-built_in">mod</span> inline {
    <span class="hljs-comment">// content of the module</span>
}

<span class="hljs-built_in">mod</span> <span class="hljs-built_in">normal</span>;
<span class="hljs-comment">// the content is in another file</span>
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">These are <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_5" class="wdautohl_ZnVuY3Rpb25hbGx5">functionally</wdautohl-customtag> equivalent. If the content of an <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_6" class="wdautohl_aW5saW5l">inline</wdautohl-customtag> module is very long, move it to another file, to keep the code neat and manageable.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">è¿™äº›åœ¨åŠŸèƒ½ä¸Šæ˜¯ç­‰ä»·çš„ã€‚å¦‚æœå†…è”æ¨¡å—çš„å†…å®¹å¾ˆé•¿ï¼Œé‚£ä¹ˆå°†å…¶ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä»¥ä¿æŒä»£ç çš„æ•´æ´å’Œå¯ç®¡ç†æ€§ã€‚</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">When the module is not <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_7" class="wdautohl_aW5saW5l">inline</wdautohl-customtag>, Rust looks for the content of the module in another file, either <code>_module_name_.rs</code> or <code>_module_name_/mod.rs</code>. It might seem odd that we have to declare modules explicitly (unlike in Python, where modules are <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_8" class="wdautohl_aW5mZXI_">inferred</wdautohl-customtag> from the file system). However, there are good reasons for this, as weâ€™ll see later.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å½“æ¨¡å—ä¸æ˜¯å†…è”çš„æ—¶å€™ï¼ŒRust ä¼šåœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­æŸ¥æ‰¾æ¨¡å—çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ _ module _ name _ã€‚æ¨¡å—åç§°/æ¨¡å—åç§°ã€‚æˆ‘ä»¬å¿…é¡»æ˜¾å¼å£°æ˜æ¨¡å—(ä¸åƒ Python ä¸­çš„æ¨¡å—æ˜¯ä»æ–‡ä»¶ç³»ç»Ÿæ¨æ–­å‡ºæ¥çš„) ï¼Œè¿™çœ‹èµ·æ¥å¯èƒ½æœ‰ç‚¹å¥‡æ€ªã€‚ç„¶è€Œï¼Œæ­£å¦‚æˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°çš„ï¼Œè¿™æ ·åšæ˜¯æœ‰å……åˆ†çš„ç†ç”±çš„ã€‚</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">Like every tree, the module tree has a <em>root</em>. This is the file <code>lib.rs</code> in case of a library crate, or the file <code>main.rs</code> in case of a binary crate <sup class="footnote">[<a href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">åƒæ¯ä¸€æ£µæ ‘ä¸€æ ·ï¼Œæ¨¡å—æ ‘ä¹Ÿæœ‰ä¸€ä¸ªæ ¹ã€‚å¦‚æœæ˜¯åº“æ¿æ¡ç®±ï¼Œåˆ™ä½¿ç”¨æ–‡ä»¶ lib.rs; å¦‚æœæ˜¯äºŒè¿›åˆ¶æ¿æ¡ç®±[1] ï¼Œåˆ™ä½¿ç”¨æ–‡ä»¶ main.rsã€‚</p>
<h3 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23submodules)Submodules"></sup><a class="header-link" href="#id-%5B%5D(%23submodules)Submodules"></a><p><a class="header-link" href="#id-%5B%5D(%23submodules)Submodules"></a><a href="#submodules"></a>Submodules</p></h3><h3 class="cyxy-trs-source cyxy-trs-target">å­æ¨¡ç»„</h3>
<p class="cyxy-trs-source cyxy-trs-source-ted">Unfortunately, Rust is not the most consistent language when it comes to modules: There are two different ways to structure a module tree, and they can be mixed within the same crate.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">ä¸å¹¸çš„æ˜¯ï¼ŒRust å¯¹äºæ¨¡å—æ¥è¯´å¹¶ä¸æ˜¯æœ€ä¸€è‡´çš„è¯­è¨€: æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼æ¥æ„é€ æ¨¡å—æ ‘ï¼Œå®ƒä»¬å¯ä»¥æ··åˆåœ¨åŒä¸€ä¸ªæ¡†æ¶ä¸­ã€‚</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">Say we have a library crate with a module <code>parent</code>, which contains a sub-module <code>child</code>:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰çˆ¶æ¨¡å—çš„åº“æ¡†æ¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå­æ¨¡å—å­æ¨¡å—:</p>
<pre><small></small><div></div><code class="hljs language-markdown">â””â”€ library root
   â””â”€ parent
<span class="hljs-code">      â””â”€ child
</span></code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">The crate root is in a <code>lib.rs</code> file in the <code>src</code> directory. However, the <code>parent</code> module can be either in a <code>parent.rs</code> file next to <code>lib.rs</code>, or in a <code>mod.rs</code> file in a <code>parent</code> directory:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æ¿æ¡ç®±æ ¹ç›®å½•ä½äº src ç›®å½•ä¸­çš„ lib.rs æ–‡ä»¶ä¸­ã€‚ä½†æ˜¯ï¼Œçˆ¶æ¨¡å—å¯ä»¥ä½äº lib.rs æ—è¾¹çš„ parent.rs æ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥ä½äºçˆ¶ç›®å½•ä¸­çš„ mod.rs æ–‡ä»¶ä¸­:</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">File tree A</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æ–‡ä»¶æ ‘ a</p>
<pre><small></small><div></div><code class="hljs language-stylus">â”œâ”€ Cargo<span class="hljs-selector-class">.toml</span>
â””â”€ <span class="hljs-attribute">src</span>/
   â”œâ”€ lib<span class="hljs-selector-class">.rs</span>
   â”œâ”€ parent<span class="hljs-selector-class">.rs</span>  <span class="hljs-comment">// parent module</span>
   â””â”€ parent/
      â””â”€ child<span class="hljs-selector-class">.rs</span>
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">File tree B</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æ¡£æ¡ˆæ ‘ b</p>
<pre><small></small><div></div><code class="hljs language-stylus">â”œâ”€ Cargo<span class="hljs-selector-class">.toml</span>
â””â”€ <span class="hljs-attribute">src</span>/
   â”œâ”€ lib<span class="hljs-selector-class">.rs</span>
   â””â”€ parent/
      â”œâ”€ mod<span class="hljs-selector-class">.rs</span>  <span class="hljs-comment">// parent module</span>
      â””â”€ child<span class="hljs-selector-class">.rs</span>
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">It doesnâ€™t really matter which way you go, just do what you prefer. I use the first way (â€œFile tree Aâ€), since itâ€™s easier to add sub-modules. For example, if you want to add a submodule to <code>child</code>, you just need to create a folder and a new file, and add a <code>mod</code> declaration:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">ä½ èµ°å“ªæ¡è·¯å¹¶ä¸é‡è¦ï¼Œåªè¦åšä½ å–œæ¬¢çš„å°±è¡Œäº†ã€‚æˆ‘ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•(â€œæ–‡ä»¶æ ‘ aâ€) ï¼Œå› ä¸ºæ·»åŠ å­æ¨¡å—æ›´å®¹æ˜“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ç»™ child æ·»åŠ ä¸€ä¸ªå­æ¨¡å—ï¼Œä½ åªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å’Œä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œç„¶åæ·»åŠ ä¸€ä¸ª mod å£°æ˜:</p>
<pre><small></small><div></div><code class="hljs language-stylus"> â”œâ”€ Cargo<span class="hljs-selector-class">.toml</span>
 â””â”€ <span class="hljs-attribute">src</span>/
    â”œâ”€ lib<span class="hljs-selector-class">.rs</span>
    â”œâ”€ parent<span class="hljs-selector-class">.rs</span>
    â””â”€ parent/
       â”œâ”€ child<span class="hljs-selector-class">.rs</span>
      â””â”€ child/
          â””â”€ grand_child<span class="hljs-selector-class">.rs</span>
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">The path of a module can also be specified explicitly with the [<code>&lt;a target="_blank" href="https://doc.rust-lang.org/reference/items/modules.html#the-path-attribute"&gt;path]</code> attribute, but this is rarely used in practice.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æ¨¡å—çš„è·¯å¾„ä¹Ÿå¯ä»¥é€šè¿‡[ &lt; a target = " _ blank" href = " https://doc.rust-lang. org/reference/items/modules # The-path-attribute" &gt; path ]å±æ€§æ˜ç¡®æŒ‡å®šï¼Œä½†è¿™åœ¨å®è·µä¸­å¾ˆå°‘ä½¿ç”¨ã€‚</p>
<h3 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23an-example)An%20example"></sup><a class="header-link" href="#id-%5B%5D(%23an-example)An%20example"></a><p><a class="header-link" href="#id-%5B%5D(%23an-example)An%20example"></a><a href="#an-example"></a>An example</p></h3><h3 class="cyxy-trs-source cyxy-trs-target">ä¸€ä¸ªä¾‹å­</h3>
<p class="cyxy-trs-source cyxy-trs-source-ted">Hopefully this will make more sense once you see an example. Hereâ€™s the module structure of a library crate:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å¸Œæœ›ä¸€æ—¦ä½ çœ‹åˆ°ä¸€ä¸ªä¾‹å­ï¼Œè¿™å°†ä¼šæ›´æœ‰æ„ä¹‰ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå›¾ä¹¦é¦†ç®±çš„æ¨¡å—ç»“æ„:</p>
<pre><small></small><div></div><code class="hljs language-stylus">â”œâ”€ Cargo<span class="hljs-selector-class">.toml</span>
â””â”€ <span class="hljs-attribute">src</span>/
   â”œâ”€ lib<span class="hljs-selector-class">.rs</span>
   â”œâ”€ foo<span class="hljs-selector-class">.rs</span>
   â”œâ”€ bar<span class="hljs-selector-class">.rs</span>
   â””â”€ bar/
      â””â”€ baz<span class="hljs-selector-class">.rs</span>
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">lib.rs</p><p class="cyxy-trs-source cyxy-trs-target">è‰æ¯”</p>
<pre><small></small><div></div><code class="hljs language-rust"><span class="hljs-comment">// root module</span>

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">mod</span> foo;
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">mod</span> bar;
</code></pre>
<p class="cyxy-trs-source">bar.rs</p>
<pre><small></small><div></div><code class="hljs language-rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">mod</span> baz;

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">use</span> baz::*;
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">use</span> crate::foo::Answer;
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">foo.rs</p><p class="cyxy-trs-source cyxy-trs-target">å¥½å§</p>
<pre><small></small><div></div><code class="hljs language-rust"><span class="hljs-keyword">mod</span> answer {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Answer</span>(<span class="hljs-keyword">pub</span> <span class="hljs-type">i32</span>);
}

<span class="hljs-keyword">pub</span> <span class="hljs-keyword">use</span> answer::Answer;
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">baz.rs</p><p class="cyxy-trs-source cyxy-trs-target">å·´å…¹</p>
<pre><small></small><div></div><code class="hljs language-scss">use super::Answer;

pub fn <span class="hljs-built_in">answer</span>() -&gt; Answer {
    <span class="hljs-built_in">Answer</span>(<span class="hljs-number">42</span>)
}
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">No worries if you donâ€™t understand everything here! All the concepts that are used here will be explained. You can look at this example later and see if you understand everything. For now, do you know what the module tree is?</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å¦‚æœä½ ä¸äº†è§£è¿™é‡Œçš„ä¸€åˆ‡ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒï¼è¿™é‡Œæ‰€ä½¿ç”¨çš„æ‰€æœ‰æ¦‚å¿µéƒ½å°†å¾—åˆ°è§£é‡Šã€‚æ‚¨å¯ä»¥ç¨åæŸ¥çœ‹è¿™ä¸ªç¤ºä¾‹ï¼Œçœ‹çœ‹æ˜¯å¦ç†è§£äº†æ‰€æœ‰å†…å®¹ã€‚ç°åœ¨ï¼Œæ‚¨çŸ¥é“æ¨¡å—æ ‘æ˜¯ä»€ä¹ˆå—ï¼Ÿ</p>
<h2 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23items-and-paths)Items%20and%20paths"></sup><a class="header-link" href="#id-%5B%5D(%23items-and-paths)Items%20and%20paths"></a><p><a class="header-link" href="#id-%5B%5D(%23items-and-paths)Items%20and%20paths"></a><a href="#items-and-paths"></a>Items and paths</p></h2><h2 class="cyxy-trs-source cyxy-trs-target" contenteditable="true">é¡¹ç›®å’Œè·¯å¾„</h2>
<p class="cyxy-trs-source cyxy-trs-source-ted">A module contains <em>items</em>. Items are</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æ¨¡å—åŒ…å«é¡¹</p>
<ul>
<li><p class="cyxy-trs-source cyxy-trs-source-ted">Functions</p><p class="cyxy-trs-source cyxy-trs-target">åŠŸèƒ½</p></li>
<li><p class="cyxy-trs-source cyxy-trs-source-ted">Types (structs, enums, unions, type <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_9" class="wdautohl_YWxpYXM_">aliases</wdautohl-customtag>)</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">ç±»å‹(ç»“æ„ã€æšä¸¾ã€è”åˆã€ç±»å‹åˆ«å)</p></li>
<li><p class="cyxy-trs-source cyxy-trs-source-ted">Traits</p><p class="cyxy-trs-source cyxy-trs-target">ç‰¹å¾</p></li>
<li><p class="cyxy-trs-source cyxy-trs-source-ted">Impl blocks</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">Impl å—</p></li>
<li><p class="cyxy-trs-source cyxy-trs-source-ted">Macros</p><p class="cyxy-trs-source cyxy-trs-target">å®</p></li>
<li><p class="cyxy-trs-source cyxy-trs-source-ted">Constants and statics</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å¸¸æ•°å’Œé™åŠ›å­¦</p></li>
<li><p class="cyxy-trs-source cyxy-trs-source-ted"><wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_10" class="wdautohl_ZXh0ZXJu">Extern</wdautohl-customtag> blocks</p><p class="cyxy-trs-source cyxy-trs-target">å¤–éƒ¨åŒºå—</p></li>
<li><p class="cyxy-trs-source cyxy-trs-source-ted"><wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_11" class="wdautohl_ZXh0ZXJu">Extern</wdautohl-customtag> crates</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å¤–é¢çš„æ¿æ¡ç®±</p></li>
<li><p class="cyxy-trs-source cyxy-trs-source-ted">Imports</p><p class="cyxy-trs-source cyxy-trs-target">è¿›å£</p></li>
<li><p class="cyxy-trs-source cyxy-trs-source-ted">Modules</p><p class="cyxy-trs-source cyxy-trs-target">å•å…ƒ</p></li>
<li><p class="cyxy-trs-source cyxy-trs-source-ted">Associated items (not important right now)</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">ç›¸å…³é¡¹ç›®(ç°åœ¨ä¸é‡è¦)</p></li>
</ul>
<p class="cyxy-trs-source cyxy-trs-source-ted">You can refer to items by their <em>path</em>. For example, the path <code>foo::bar::Baz</code> refers to the <code>Baz</code> item within the <code>bar</code> item within the <code>foo</code> item. Paths are usually relative: To use <code>foo::bar::Baz</code>, the <code>foo</code> item must be available in the current scope; absolute paths (starting at the root module) are <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_12" class="wdautohl_cHJlZml4">prefixed</wdautohl-customtag> with <code>crate::</code>. A <code>super::</code> path segment changes to the parent module (similar to <code>../</code> in the file system).</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æ‚¨å¯ä»¥æ ¹æ®é¡¹ç›®çš„è·¯å¾„å¼•ç”¨å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œè·¯å¾„ foo: : bar: Baz å¼•ç”¨ foo é¡¹ä¸­ bar é¡¹ä¸­çš„ Baz é¡¹ã€‚è·¯å¾„é€šå¸¸æ˜¯ç›¸å¯¹çš„: è¦ä½¿ç”¨ foo: : bar: : Bazï¼Œfoo é¡¹ç›®å¿…é¡»åœ¨å½“å‰ä½œç”¨åŸŸä¸­å¯ç”¨; ç»å¯¹è·¯å¾„(ä»æ ¹æ¨¡å—å¼€å§‹)ä»¥ crate: : ä½œä¸ºå‰ç¼€ã€‚è·¯å¾„æ®µæ›´æ”¹ä¸ºçˆ¶æ¨¡å—(ç±»ä¼¼äºã€‚./åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­)ã€‚</p>
<p class="cyxy-trs-source cyxy-trs-source-ted"><em>Imports</em> are used to <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_13" class="wdautohl_c2hvcnRlbg__">shorten</wdautohl-customtag> paths. Instead of having to write <code>foo::bar::Baz</code> every time, we can write <code>use foo::bar::Baz;</code> once. This brings the item into scope, so we can refer to it with the much shorter path <code>Baz</code>.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å¯¼å…¥ç”¨äºç¼©çŸ­è·¯å¾„ã€‚ä¸å¿…æ¯æ¬¡éƒ½å†™ foo: : bar: Bazï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ foo: : bar: Baz; ä¸€æ¬¡ã€‚è¿™ä½¿å¾—è¿™ä¸ªé¡¹ç›®è¿›å…¥äº†èŒƒå›´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´çŸ­çš„è·¯å¾„ Baz æ¥å¼•ç”¨å®ƒã€‚</p>
<table>

<tbody>

<tr>

<td class="content"><span class="cyxy-trs-source cyxy-trs-source-ted">Changes to paths in the 2018 edition

Prior to the 2018 edition, absolute paths started with just `::` instead of `crate::`. In the 2018 edition, this syntax is still available, but itâ€™s not recommended and can only be used for external crates.

In the 2015 edition, imports were always absolute, even when they werenâ€™t <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_14" class="wdautohl_cHJlZml4">prefixed</wdautohl-customtag> with `::`. This was fixed in the 2018 edition for more consistency.

The 2018 edition also changed how external crates are used: In the 2015 edition, to use an external crate, an `extern crate` declaration was needed. This is no longer required in most cases: We can just put <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_15" class="wdautohl_ZGVwZW5kZW5jeQ__">dependencies</wdautohl-customtag> in our `Cargo.toml`, and use them right away.

</span><span class="cyxy-trs-source cyxy-trs-target" contenteditable="true">2018å¹´ç‰ˆçš„è·¯å¾„å˜åŒ–åœ¨2018å¹´ç‰ˆä¹‹å‰ï¼Œç»å¯¹è·¯å¾„ä»¥â€˜ :â€™è€Œä¸æ˜¯â€˜ crate: :â€™å¼€å§‹ã€‚åœ¨2018å¹´ç‰ˆæœ¬ä¸­ï¼Œè¿™ç§è¯­æ³•ä»ç„¶å¯ç”¨ï¼Œä½†æ˜¯ä¸æ¨èï¼Œåªèƒ½ç”¨äºå¤–éƒ¨ç®±å­ã€‚åœ¨2015å¹´çš„ç‰ˆæœ¬ä¸­ï¼Œè¿›å£æ€»æ˜¯ç»å¯¹çš„ï¼Œå³ä½¿å‰é¢æ²¡æœ‰åŠ ä¸Šâ€˜ : :â€™ã€‚ä¸ºäº†æ›´åŠ ä¸€è‡´ï¼Œ2018å¹´ç‰ˆæœ¬å¯¹æ­¤è¿›è¡Œäº†ä¿®æ”¹ã€‚2018å¹´ç‰ˆä¹Ÿæ”¹å˜äº†å¤–éƒ¨æ¿æ¡ç®±çš„ä½¿ç”¨æ–¹å¼: åœ¨2015å¹´ç‰ˆä¸­ï¼Œä¸ºäº†ä½¿ç”¨å¤–éƒ¨æ¿æ¡ç®±ï¼Œéœ€è¦ä¸€ä¸ªå¤–éƒ¨æ¿æ¡ç®±å£°æ˜ã€‚è¿™åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¸å†éœ€è¦: æˆ‘ä»¬å¯ä»¥å°†ä¾èµ–é¡¹æ”¾åœ¨ Cargo.toml ä¸­ï¼Œå¹¶ç«‹å³ä½¿ç”¨å®ƒä»¬ã€‚</span></td>

</tr>

</tbody>

</table>
<h2 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23visibility)Visibility"></sup><a class="header-link" href="#id-%5B%5D(%23visibility)Visibility"></a><p><a class="header-link" href="#id-%5B%5D(%23visibility)Visibility"></a><a href="#visibility"></a>Visibility</p></h2><h2 class="cyxy-trs-source cyxy-trs-target">èƒ½è§åº¦</h2>
<p class="cyxy-trs-source cyxy-trs-source-ted"><em>Visibility</em>, or <em>privacy</em>, is the concept of making parts of a module <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_16" class="wdautohl_aW5hY2Nlc3NpYmxl">inaccessible</wdautohl-customtag> from other modules. Things that are only accessible in the same module are called <em>private</em>, and things that are accessible everywhere are called <em>public</em>.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å¯è§æ€§ï¼Œæˆ–è€…è¯´éšç§æ€§ï¼Œå°±æ˜¯ä½¿æ¨¡å—çš„æŸäº›éƒ¨åˆ†ä»å…¶ä»–æ¨¡å—ä¸­æ— æ³•è®¿é—®çš„æ¦‚å¿µã€‚åªæœ‰åœ¨åŒä¸€ä¸ªæ¨¡å—ä¸­æ‰èƒ½è®¿é—®çš„å†…å®¹ç§°ä¸ºç§æœ‰å†…å®¹ï¼Œè€Œå¤„å¤„å¯è®¿é—®çš„å†…å®¹ç§°ä¸ºå…¬æœ‰å†…å®¹ã€‚</p>
<table>

<tbody>

<tr>

<td class="content"><span class="cyxy-trs-source cyxy-trs-source-ted">

This concept exists in many programming languages. However, in most object-<wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_17" class="wdautohl_b3JpZW50">oriented</wdautohl-customtag> languages, the privacy boundary is the _class_, whereas in Rust, the modules are privacy boundaries.

</span><span class="cyxy-trs-source cyxy-trs-target" contenteditable="true">è¿™ä¸ªæ¦‚å¿µå­˜åœ¨äºè®¸å¤šç¼–ç¨‹è¯­è¨€ä¸­ã€‚ç„¶è€Œï¼Œåœ¨å¤§å¤šæ•°é¢å‘å¯¹è±¡è¯­è¨€ä¸­ï¼Œéšç§è¾¹ç•Œæ˜¯ _ class _ï¼Œè€Œåœ¨ Rust ä¸­ï¼Œæ¨¡å—æ˜¯éšç§è¾¹ç•Œã€‚</span></td>

</tr>

</tbody>

</table>
<p class="cyxy-trs-source cyxy-trs-source-ted">In Rust, most things are private by default. To make something public, the <code>pub</code> <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_18" class="wdautohl_a2V5d29yZA__">keyword</wdautohl-customtag> is written before it. This makes the item accessible everywhere:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">åœ¨ Rust ä¸­ï¼Œå¤§å¤šæ•°ä¸œè¥¿é»˜è®¤æ˜¯ç§äººçš„ã€‚ä¸ºäº†ä½¿æŸäº‹å…¬å¼€ï¼Œåœ¨å®ƒä¹‹å‰å†™ä¸Š pub å…³é”®å­—ã€‚è¿™ä½¿å¾—è¿™ä¸ªé¡¹ç›®æ— å¤„ä¸åœ¨:</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">lib.rs</p><p class="cyxy-trs-source cyxy-trs-target">è‰æ¯”</p>
<pre><small></small><div></div><code class="hljs language-rust"><span class="hljs-keyword">mod</span> foo {  (<span class="hljs-number">1</span>)
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">mod</span> bar {
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Baz</span>;
    }
    <span class="hljs-comment">// use bar::Baz;  (2)</span>
}

<span class="hljs-keyword">use</span> foo::bar;  (<span class="hljs-number">3</span>)
</code></pre>
<table>

<tbody>

<tr>

<td class="cyxy-trs-source">**1**<font class="cyxy-trs-target" contenteditable="true"> * * * * *</font></td>

<td><span class="cyxy-trs-source cyxy-trs-source-ted">This declares a private module, so it can only be used within this root module. It canâ€™t be accessed from another crate.</span><span class="cyxy-trs-source cyxy-trs-target" contenteditable="true">è¿™å£°æ˜äº†ä¸€ä¸ªç§æœ‰æ¨¡å—ï¼Œå› æ­¤å®ƒåªèƒ½åœ¨è¿™ä¸ªæ ¹æ¨¡å—ä¸­ä½¿ç”¨ã€‚ä¸èƒ½ä»å¦ä¸€ä¸ªç®±å­è¿›å…¥ã€‚</span></td>

</tr>

<tr>

<td class="cyxy-trs-source">**2**<font class="cyxy-trs-target" contenteditable="true"> * * 2 * *</font></td>

<td><span class="cyxy-trs-source cyxy-trs-source-ted">If we uncommented this, it would fail to compile. `Baz` is private, therefore it can only be used within the `bar` module.</span><span class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å¦‚æœæˆ‘ä»¬å–æ¶ˆæ³¨é‡Šï¼Œå®ƒå°†æ— æ³•ç¼–è¯‘ã€‚â€˜ Bazâ€™æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤åªèƒ½åœ¨â€˜ barâ€™æ¨¡å—ä¸­ä½¿ç”¨ã€‚</span></td>

</tr>

<tr>

<td class="cyxy-trs-source">**3**<font class="cyxy-trs-target" contenteditable="true"> * 3 * * *</font></td>

<td><span class="cyxy-trs-source cyxy-trs-source-ted">The module `bar` can be used here, because it is declared as public. This is somewhat counter-intuitive, since the `foo` module is private. But when a module is private, it can still be accessed within its direct parent module, since a module is just like any other item.</span><span class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æ¨¡å—â€˜ barâ€™å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ï¼Œå› ä¸ºå®ƒè¢«å£°æ˜ä¸ºå…¬å…±çš„ã€‚è¿™æœ‰ç‚¹è¿åç›´è§‰ï¼Œå› ä¸ºâ€˜ fooâ€™æ¨¡å—æ˜¯ç§æœ‰çš„ã€‚ä½†æ˜¯ï¼Œå½“æ¨¡å—æ˜¯ç§æœ‰çš„æ—¶å€™ï¼Œå®ƒä»ç„¶å¯ä»¥åœ¨å®ƒçš„ç›´æ¥çˆ¶æ¨¡å—ä¸­è®¿é—®ï¼Œå› ä¸ºæ¨¡å—å°±åƒå…¶ä»–ä»»ä½•é¡¹ç›®ä¸€æ ·ã€‚</span></td>

</tr>

</tbody>

</table>
<h3 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23encapsulation)%3Cwdautohl-customtag%20style%3D%22font-weight%3Abold%3Bcolor%3Ared%3Bfont-size%3Ainherit%3Bdisplay%3Ainline%3B%22%20id%3D%22wdautohl_id_19%22%20class%3D%22wdautohl_ZW5jYXBzdWxhdGlvbg__%22%3EEncapsulation%3C%2Fwdautohl-customtag%3E"></sup><a class="header-link" href="#id-%5B%5D(%23encapsulation)%3Cwdautohl-customtag%20style%3D%22font-weight%3Abold%3Bcolor%3Ared%3Bfont-size%3Ainherit%3Bdisplay%3Ainline%3B%22%20id%3D%22wdautohl_id_19%22%20class%3D%22wdautohl_ZW5jYXBzdWxhdGlvbg__%22%3EEncapsulation%3C%2Fwdautohl-customtag%3E"></a><p><a class="header-link" href="#id-%5B%5D(%23encapsulation)%3Cwdautohl-customtag%20style%3D%22font-weight%3Abold%3Bcolor%3Ared%3Bfont-size%3Ainherit%3Bdisplay%3Ainline%3B%22%20id%3D%22wdautohl_id_19%22%20class%3D%22wdautohl_ZW5jYXBzdWxhdGlvbg__%22%3EEncapsulation%3C%2Fwdautohl-customtag%3E"></a><a href="#encapsulation"></a><wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_19" class="wdautohl_ZW5jYXBzdWxhdGlvbg__">Encapsulation</wdautohl-customtag></p></h3><h3 class="cyxy-trs-source cyxy-trs-target">å°è£…</h3>
<p class="cyxy-trs-source cyxy-trs-source-ted">When designing an API, there are often <em>invariants</em> that need to be preserved. An <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_20" class="wdautohl_aW52YXJpYW50">invariant</wdautohl-customtag> is a property that never changes. For example, a struct might contain a value that is supposed to always be within the interval [0; 360):</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">åœ¨è®¾è®¡ API æ—¶ï¼Œé€šå¸¸éœ€è¦ä¿ç•™ä¸å˜é‡ã€‚ä¸å˜å¼æ˜¯ä¸€ä¸ªæ°¸è¿œä¸å˜çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç»“æ„ä½“å¯èƒ½åŒ…å«ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼åº”è¯¥æ€»æ˜¯åœ¨é—´éš”[0; 360)å†…:</p>
<pre><small></small><div></div><code class="hljs language-reasonml">pub <span class="hljs-keyword">struct</span> <span class="hljs-constructor">Angle(<span class="hljs-params">pub</span> <span class="hljs-params">f32</span>)</span>;
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">Letâ€™s write a <code>new</code> function that validates this <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_21" class="wdautohl_aW52YXJpYW50">invariant</wdautohl-customtag>, and a getter for the value:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæ–°çš„å‡½æ•°æ¥éªŒè¯è¿™ä¸ªä¸å˜é‡ï¼Œå¹¶ä¸ºè¿™ä¸ªå€¼ç¼–å†™ä¸€ä¸ª getter:</p>
<pre><small></small><div></div><code class="hljs language-rust"><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Angle</span> {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(value: <span class="hljs-type">f32</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-title function_ invoke__">Angle</span>(value.<span class="hljs-title function_ invoke__">rem_euclid</span>(<span class="hljs-number">360.0</span>)) (<span class="hljs-number">1</span>)
    }

    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">value</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f32</span> {
        <span class="hljs-keyword">self</span>.<span class="hljs-number">0</span>
    }
}
</code></pre>
<table>

<tbody>

<tr>

<td class="cyxy-trs-source">**1**<font class="cyxy-trs-target" contenteditable="true"> * * * * *</font></td>

<td><span class="cyxy-trs-source cyxy-trs-source-ted">[`rem_euclid`](https://doc.rust-lang.org/std/primitive.f32.html#method.rem_euclid) calculates the least nonnegative remainder of `self (mod rhs)`.</span><span class="cyxy-trs-source cyxy-trs-target" contenteditable="true">[â€™remâ€™euclidâ€™]( https://doc.rust-lang.org/std/primitive.f32.html#method.rem_euclid )è®¡ç®—â€˜ self (mod rhs)â€™çš„æœ€å°éè´Ÿä½™æ•°ã€‚</span></td>

</tr>

</tbody>

</table>
<p class="cyxy-trs-source cyxy-trs-source-ted">By ensuring that the angle is always in [0; 360), we can implement operations such as equality (where 0Â° == 360Â°) very easily. But wait! Since the field is public, a user of the API can create an <code>Angle</code> object without calling the <code>new</code> function, or modify it without checking the <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_22" class="wdautohl_aW52YXJpYW50">invariant</wdautohl-customtag>.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">é€šè¿‡ç¡®ä¿è§’åº¦å§‹ç»ˆåœ¨[0; 360]ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸å®¹æ˜“åœ°å®ç°ç­‰å¼(å…¶ä¸­0 Â° = 360 Â°)ç­‰æ“ä½œã€‚ä½†æ˜¯ç­‰ç­‰ï¼å› ä¸ºå­—æ®µæ˜¯å…¬å…±çš„ï¼ŒAPI çš„ç”¨æˆ·å¯ä»¥åˆ›å»ºä¸€ä¸ª Angle å¯¹è±¡è€Œä¸éœ€è¦è°ƒç”¨æ–°å‡½æ•°ï¼Œæˆ–è€…ä¿®æ”¹å®ƒè€Œä¸éœ€è¦æ£€æŸ¥ä¸å˜é‡ã€‚</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">By making the field private, the structâ€™s implementation details are hidden. This is called <em>encapsulation</em>: Within this module, we still have to take special care that the <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_23" class="wdautohl_aW52YXJpYW50">invariant</wdautohl-customtag> is preserved, but if the code is correct, the public API is impossible to use incorrectly.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">é€šè¿‡å°†å­—æ®µè®¾ç½®ä¸ºç§æœ‰ï¼Œè¯¥ç»“æ„çš„å®ç°ç»†èŠ‚å°†è¢«éšè—ã€‚è¿™è¢«ç§°ä¸ºå°è£…: åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ç‰¹åˆ«æ³¨æ„ä¿ç•™ä¸å˜å¼ï¼Œä½†æ˜¯å¦‚æœä»£ç æ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå…¬å…± API å°±ä¸å¯èƒ½è¢«é”™è¯¯åœ°ä½¿ç”¨ã€‚</p>
<h3 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23fine-grained-visibility)Fine-grained%20visibility"></sup><a class="header-link" href="#id-%5B%5D(%23fine-grained-visibility)Fine-grained%20visibility"></a><p><a class="header-link" href="#id-%5B%5D(%23fine-grained-visibility)Fine-grained%20visibility"></a><a href="#fine-grained-visibility"></a>Fine-grained visibility</p></h3><h3 class="cyxy-trs-source cyxy-trs-target" contenteditable="true">ç»†ç²’åº¦çš„å¯è§æ€§</h3>
<p class="cyxy-trs-source cyxy-trs-source-ted">Items can be private or public. However, there are also visibilities in-between: Most notably, an item can be declared as <code>pub(crate)</code>. This means that it is visible <em>within the current crate</em>, but not outside. With <code>pub(super)</code>, an item is visible within the parent module. With <code>pub(in _path_)</code>, visibility can also be limited to any other module as well:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">é¡¹ç›®å¯ä»¥æ˜¯ç§äººçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¬å…±çš„ã€‚ç„¶è€Œï¼Œåœ¨ä¸¤è€…ä¹‹é—´ä¹Ÿæœ‰å¯è§æ€§: æœ€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªé¡¹ç›®å¯ä»¥å£°æ˜ä¸º pub (æ¿æ¡ç®±)ã€‚è¿™æ„å‘³ç€å®ƒåœ¨å½“å‰æ¿æ¡ç®±å†…æ˜¯å¯è§çš„ï¼Œä½†åœ¨å¤–éƒ¨æ˜¯ä¸å¯è§çš„ã€‚ä½¿ç”¨ pub (è¶…çº§) ï¼Œåœ¨çˆ¶æ¨¡å—ä¸­å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ¡ç›®ã€‚ä½¿ç”¨ pub (in _ path _) ï¼Œå¯è§æ€§ä¹Ÿå¯ä»¥é™åˆ¶åˆ°ä»»ä½•å…¶ä»–æ¨¡å—:</p>
<pre><small></small><div></div><code class="hljs language-scss"><span class="hljs-built_in">pub</span>(crate) mod foo {
    <span class="hljs-built_in">pub</span>(super) fn <span class="hljs-built_in">bar</span>() {}
    <span class="hljs-built_in">pub</span>(in crate::foo) struct Baz;
}
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">When something is visible in one module, it is also visible in all its child modules. It still needs to be imported (or referred to with its path) though:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å½“ä¸€ä¸ªæ¨¡å—ä¸­çš„æŸäº›å†…å®¹å¯è§æ—¶ï¼Œå®ƒåœ¨å…¶æ‰€æœ‰å­æ¨¡å—ä¸­ä¹Ÿå¯è§ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒä»ç„¶éœ€è¦è¢«å¯¼å…¥(æˆ–è€…ç”¨å®ƒçš„è·¯å¾„æ¥æŒ‡ä»£) :</p>
<pre><small></small><div></div><code class="hljs language-rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Foo</span>;
<span class="hljs-comment">// Foo is visible in this module</span>

<span class="hljs-keyword">mod</span> inner {
    <span class="hljs-keyword">use</span> super::Foo;
    <span class="hljs-comment">// Foo is also visible here!</span>
}
</code></pre>
<h3 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23visibilities-overview)Visibilities%20overview"></sup><a class="header-link" href="#id-%5B%5D(%23visibilities-overview)Visibilities%20overview"></a><p><a class="header-link" href="#id-%5B%5D(%23visibilities-overview)Visibilities%20overview"></a><a href="#visibilities-overview"></a>Visibilities overview</p></h3><h3 class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å¯è§†æ€§æ¦‚è¿°</h3>
<table class="tableblock frame-all grid-all fit-content fancy"><colgroup><col> <col></colgroup> 

<tbody>

<tr>

<td class="tableblock halign-left valign-top cyxy-trs-source">

`pub`

<font class="cyxy-trs-target"> â€é…’å§â€</font></td>

<td class="tableblock halign-left valign-top cyxy-trs-source">

The item is visible everywhere

<font class="cyxy-trs-target" contenteditable="true"> è¿™ä»¶ç‰©å“éšå¤„å¯è§</font></td>

</tr>

<tr>

<td class="tableblock halign-left valign-top cyxy-trs-source">

`pub(crate)`

<font class="cyxy-trs-target" contenteditable="true"> é…’å§(æ¿æ¡ç®±)</font></td>

<td class="tableblock halign-left valign-top"><span class="cyxy-trs-source cyxy-trs-source-ted">

The item is visible in the current crate

</span><span class="cyxy-trs-source cyxy-trs-target" contenteditable="true">è¯¥é¡¹åœ¨å½“å‰æ¿æ¡ç®±ä¸­å¯è§</span></td>

</tr>

<tr>

<td class="tableblock halign-left valign-top cyxy-trs-source">

`pub(super)`

<font class="cyxy-trs-target" contenteditable="true"> â€˜ pub (super)â€™</font></td>

<td class="tableblock halign-left valign-top"><span class="cyxy-trs-source cyxy-trs-source-ted">

The item is visible in the parent module

</span><span class="cyxy-trs-source cyxy-trs-target" contenteditable="true">è¯¥é¡¹åœ¨çˆ¶æ¨¡å—ä¸­å¯è§</span></td>

</tr>

<tr>

<td class="tableblock halign-left valign-top cyxy-trs-source">

`pub(in&nbsp;some::path)`

<font class="cyxy-trs-target" contenteditable="true"> â€˜ pub (in some: : path)â€™</font></td>

<td class="tableblock halign-left valign-top"><span class="cyxy-trs-source cyxy-trs-source-ted">

The item is visible in the specified path. The path must refer to an <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_24" class="wdautohl_YW5jZXN0b3I_">ancestor</wdautohl-customtag> module of the item.

</span><span class="cyxy-trs-source cyxy-trs-target" contenteditable="true">è¯¥é¡¹åœ¨æŒ‡å®šè·¯å¾„ä¸­å¯è§ã€‚è¯¥è·¯å¾„å¿…é¡»å¼•ç”¨è¯¥é¡¹çš„ç¥–å…ˆæ¨¡å—ã€‚</span></td>

</tr>

<tr>

<td class="tableblock halign-left valign-top cyxy-trs-source">

`pub(self)`

<font class="cyxy-trs-target" contenteditable="true"> â€˜ pub (self)â€™</font></td>

<td class="tableblock halign-left valign-top"><span class="cyxy-trs-source cyxy-trs-source-ted">

The item is private, i.e. visible only in the same module. This is equivalent to <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_25" class="wdautohl_b21pdA__">omitting</wdautohl-customtag> the visibility entirely.

</span><span class="cyxy-trs-source cyxy-trs-target" contenteditable="true">è¯¥é¡¹æ˜¯ç§æœ‰çš„ï¼Œå³åªåœ¨åŒä¸€ä¸ªæ¨¡å—ä¸­å¯è§ã€‚è¿™ç­‰åŒäºå®Œå…¨å¿½ç•¥å¯è§æ€§ã€‚</span></td>

</tr>

</tbody>

</table>
<h2 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23exports)Exports"></sup><a class="header-link" href="#id-%5B%5D(%23exports)Exports"></a><p><a class="header-link" href="#id-%5B%5D(%23exports)Exports"></a><a href="#exports"></a>Exports</p></h2><h2 class="cyxy-trs-source cyxy-trs-target">å‡ºå£</h2>
<p class="cyxy-trs-source cyxy-trs-source-ted">With <code>pub use</code> declarations, items can be <em>re-exported</em> from a different module than the one they were declared in. A re-exported item has multiple paths that refer to the same thing. For example:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">é€šè¿‡ä½¿ç”¨ pub ä½¿ç”¨å£°æ˜ï¼Œå¯ä»¥ä»ä¸åŒçš„æ¨¡å—é‡æ–°å¯¼å‡ºé¡¹ï¼Œè€Œä¸æ˜¯åœ¨å…¶ä¸­å£°æ˜çš„æ¨¡å—ã€‚é‡æ–°å¯¼å‡ºçš„é¡¹å…·æœ‰å¤šä¸ªæŒ‡å‘åŒä¸€äº‹ç‰©çš„è·¯å¾„ã€‚ä¾‹å¦‚:</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">lib.rs</p><p class="cyxy-trs-source cyxy-trs-target">è‰æ¯”</p>
<pre><small></small><div></div><code class="hljs language-rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">mod</span> answer {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">const</span> ANSWER: <span class="hljs-type">i32</span> = <span class="hljs-number">42</span>;
}
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">use</span> answer::ANSWER;
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">Now <code>ANSWER</code> can be referred to as either <code>crate::ANSWER</code> or <code>crateâ€‹::answer::ANSWER</code>. However, not every path is always <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_26" class="wdautohl_cmVhY2hhYmxl">reachable</wdautohl-customtag>. Take, for example:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">ç°åœ¨ï¼Œç­”æ¡ˆå¯ä»¥è¢«ç§°ä¸ºä»»ä½•ä¸€ä¸ªæ¿æ¡ç®±: : ç­”æ¡ˆæˆ–æ¿æ¡ç®±: : ç­”æ¡ˆã€‚ç„¶è€Œï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è·¯å¾„éƒ½æ˜¯å¯ä»¥åˆ°è¾¾çš„ã€‚ä¸¾ä¸ªä¾‹å­:</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">lib.rs</p><p class="cyxy-trs-source cyxy-trs-target">è‰æ¯”</p>
<pre><small></small><div></div><code class="hljs language-rust"><span class="hljs-keyword">mod</span> answer {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">const</span> ANSWER: <span class="hljs-type">i32</span> = <span class="hljs-number">42</span>;
}
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">use</span> answer::ANSWER;
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted"><code>crateâ€‹::answer::ANSWER</code> is public, but it canâ€™t be used from outside the crate, because the <code>answer</code> module is private. Only the re-export <code>crate::ANSWER</code> can be used from outside the crate.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å›ç­”: : ANSWER æ˜¯å…¬å…±çš„ï¼Œä½†ä¸èƒ½åœ¨ç®±å­å¤–ä½¿ç”¨ï¼Œå› ä¸ºå›ç­”æ¨¡å—æ˜¯ç§æœ‰çš„ã€‚åªæœ‰å†å‡ºå£æ¿æ¡ç®±: : æ‰èƒ½ä»ç®±å¤–ä½¿ç”¨ã€‚</p>
<h2 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23common-pitfalls)Common%20%3Cwdautohl-customtag%20style%3D%22font-weight%3Abold%3Bcolor%3Ared%3Bfont-size%3Ainherit%3Bdisplay%3Ainline%3B%22%20id%3D%22wdautohl_id_27%22%20class%3D%22wdautohl_cGl0ZmFsbA__%22%3Epitfalls%3C%2Fwdautohl-customtag%3E"></sup><a class="header-link" href="#id-%5B%5D(%23common-pitfalls)Common%20%3Cwdautohl-customtag%20style%3D%22font-weight%3Abold%3Bcolor%3Ared%3Bfont-size%3Ainherit%3Bdisplay%3Ainline%3B%22%20id%3D%22wdautohl_id_27%22%20class%3D%22wdautohl_cGl0ZmFsbA__%22%3Epitfalls%3C%2Fwdautohl-customtag%3E"></a><p><a class="header-link" href="#id-%5B%5D(%23common-pitfalls)Common%20%3Cwdautohl-customtag%20style%3D%22font-weight%3Abold%3Bcolor%3Ared%3Bfont-size%3Ainherit%3Bdisplay%3Ainline%3B%22%20id%3D%22wdautohl_id_27%22%20class%3D%22wdautohl_cGl0ZmFsbA__%22%3Epitfalls%3C%2Fwdautohl-customtag%3E"></a><a href="#common-pitfalls"></a>Common <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_27" class="wdautohl_cGl0ZmFsbA__">pitfalls</wdautohl-customtag></p></h2><h2 class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å¸¸è§çš„é™·é˜±</h2>
<dl>

<dt class="hdlist1 cyxy-trs-source cyxy-trs-source-ted">The module tree must be built manually.</dt><dt class="hdlist1 cyxy-trs-source cyxy-trs-target" contenteditable="true">æ¨¡å—æ ‘å¿…é¡»æ‰‹åŠ¨ç”Ÿæˆã€‚</dt>

<dd class="cyxy-trs-source cyxy-trs-source-ted">

Thereâ€™s no <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_28" class="wdautohl_aW1wbGljaXQ_">implicit</wdautohl-customtag> mapping from the _file system tree_ to the _module tree_: We need to declare all modules with the `mod` <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_29" class="wdautohl_a2V5d29yZA__">keyword</wdautohl-customtag>.

</dd><dd class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æ²¡æœ‰ä» _ æ–‡ä»¶ç³»ç»Ÿæ ‘åˆ° _ æ¨¡å—æ ‘çš„éšå¼æ˜ å°„: æˆ‘ä»¬éœ€è¦ä½¿ç”¨â€˜ modâ€™å…³é”®å­—å£°æ˜æ‰€æœ‰æ¨¡å—ã€‚</dd>

<dt class="hdlist1 cyxy-trs-source cyxy-trs-source-ted">Donâ€™t confuse _visibility_ with _reachability_.</dt><dt class="hdlist1 cyxy-trs-source cyxy-trs-target" contenteditable="true">ä¸è¦æ··æ·†å¯è§æ€§å’Œå¯è¾¾æ€§ã€‚</dt>

<dd class="cyxy-trs-source cyxy-trs-source-ted">

The visibility of an item is like an _upper bound_, it canâ€™t be increased with re-exports. For example, we canâ€™t re-export a private struct outside of its module.

However, a public item might not be <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_30" class="wdautohl_cmVhY2hhYmxl">reachable</wdautohl-customtag> from outside the crate, if itâ€™s in a private module and isnâ€™t publicly re-exported. To make an item available in the crate root, itâ€™s not enough to make it public; we also need to make it <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_31" class="wdautohl_cmVhY2hhYmxl">reachable</wdautohl-customtag> from the crate root.

</dd><dd class="cyxy-trs-source cyxy-trs-target" contenteditable="true">ä¸€ä¸ªé¡¹ç›®çš„å¯è§æ€§å°±åƒä¸€ä¸ª _ ä¸Šç•Œ _ï¼Œå®ƒä¸èƒ½éšç€å†å‡ºå£è€Œå¢åŠ ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨æ¨¡å—ä¹‹å¤–é‡æ–°å¯¼å‡ºç§æœ‰ç»“æ„ã€‚ä½†æ˜¯ï¼Œå¦‚æœå…¬å…±é¡¹ç›®ä½äºç§æœ‰æ¨¡å—ä¸­å¹¶ä¸”ä¸å…¬å¼€é‡æ–°å¯¼å‡ºï¼Œåˆ™å¯èƒ½æ— æ³•ä»æ¿æ¡ç®±å¤–éƒ¨è®¿é—®è¯¥å…¬å…±é¡¹ç›®ã€‚è¦ä½¿é¡¹åœ¨æ¿æ¡ç®±æ ¹ç›®å½•ä¸­å¯ç”¨ï¼Œä»…å°†å…¶å…¬å¼€æ˜¯ä¸å¤Ÿçš„; æˆ‘ä»¬è¿˜éœ€è¦ä½¿å®ƒä»æ¿æ¡ç®±æ ¹ç›®å½•å¯è®¿é—®ã€‚</dd>

<dt class="hdlist1 cyxy-trs-source cyxy-trs-source-ted">Donâ€™t confuse _visibility_ with _availability_.</dt><dt class="hdlist1 cyxy-trs-source cyxy-trs-target" contenteditable="true">ä¸è¦æ··æ·†å¯è§æ€§å’Œå¯ç”¨æ€§ã€‚</dt>

<dd class="cyxy-trs-source cyxy-trs-source-ted">

Visibility means that we are <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_32" class="wdautohl_cHJpbmNpcGFsbHk_">principally</wdautohl-customtag> allowed to use an item somewhere. It doesnâ€™t mean that the item is available, i.e. _in scope_, so we might still have to import it (or refer to it with its path).

</dd><dd class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å¯è§æ€§æ„å‘³ç€æˆ‘ä»¬ä¸»è¦è¢«å…è®¸åœ¨æŸå¤„ä½¿ç”¨ä¸€ä¸ªé¡¹ç›®ã€‚è¿™å¹¶ä¸æ„å‘³ç€è¯¥é¡¹æ˜¯å¯ç”¨çš„ï¼Œä¾‹å¦‚ _ in scope _ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯èƒ½ä»ç„¶éœ€è¦å¯¼å…¥å®ƒ(æˆ–è€…ç”¨å®ƒçš„è·¯å¾„å¼•ç”¨å®ƒ)ã€‚</dd>

</dl>
<h2 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23special-cases)Special%20cases"></sup><a class="header-link" href="#id-%5B%5D(%23special-cases)Special%20cases"></a><p><a class="header-link" href="#id-%5B%5D(%23special-cases)Special%20cases"></a><a href="#special-cases"></a>Special cases</p></h2><h2 class="cyxy-trs-source cyxy-trs-target">ç‰¹æ®Šæƒ…å†µ</h2>
<p class="cyxy-trs-source cyxy-trs-source-ted">There are a few language constructs that donâ€™t adhere to the same rules as everything else:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æœ‰ä¸€äº›è¯­è¨€ç»“æ„å¹¶ä¸éµå¾ªä¸å…¶ä»–ä»»ä½•äº‹ç‰©ç›¸åŒçš„è§„åˆ™:</p>
<h3 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23enum-variants-and-fields)Enum%20variants%20and%20fields"></sup><a class="header-link" href="#id-%5B%5D(%23enum-variants-and-fields)Enum%20variants%20and%20fields"></a><p><a class="header-link" href="#id-%5B%5D(%23enum-variants-and-fields)Enum%20variants%20and%20fields"></a><a href="#enum-variants-and-fields"></a>Enum variants and fields</p></h3><h3 class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å˜ä½“å’Œå­—æ®µ</h3>
<p class="cyxy-trs-source cyxy-trs-source-ted">Enum variants and variant fields are always public, and itâ€™s not possible to make them private. Therefore we should be careful when exposing enums publicly, because changing the variants or fields later is not backwards compatible.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æšä¸¾å˜ä½“å’Œå˜ä½“å­—æ®µæ€»æ˜¯å…¬å¼€çš„ï¼Œä¸å¯èƒ½å°†å®ƒä»¬è®¾ç½®ä¸ºç§æœ‰ã€‚å› æ­¤ï¼Œåœ¨å…¬å¼€ enum æ—¶åº”è¯¥å°å¿ƒï¼Œå› ä¸ºç¨åæ›´æ”¹å˜é‡æˆ–å­—æ®µæ˜¯ä¸å‘åå…¼å®¹çš„ã€‚</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">You can add the [<code>&lt;a target="_blank" href="https://doc.rust-lang.org/nightly/reference/attributes/type_system.html#the-non_exhaustive-attribute"&gt;non_exhaustive]</code> attribute to an enum to allow adding more variants later. This mean that the enum canâ€™t be matched <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_33" class="wdautohl_ZXhoYXVzdGl2ZWx5">exhaustively</wdautohl-customtag>; weâ€™ll always need to add a wildcard match arm (<code>_ =&gt; {}</code>).</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">ä½ å¯ä»¥åœ¨ enum ä¸­æ·»åŠ [[ &lt; a target = " _ blank" href = " https://doc.rust-lang. org/nightly/reference/attributes/type _ system. html # the-non _ ç©·ä¸¾-attribute" &gt; non _ ç©·ä¸¾]å±æ€§ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥æ·»åŠ æ›´å¤šçš„å˜ä½“ã€‚è¿™æ„å‘³ç€æšä¸¾æ— æ³•å®Œå…¨åŒ¹é…; æˆ‘ä»¬æ€»æ˜¯éœ€è¦æ·»åŠ ä¸€ä¸ªé€šé…ç¬¦åŒ¹é…è‡‚(_ = &gt; {})ã€‚</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">Sometimes itâ€™s a good idea to wrap an enum in a struct to hide the implementation details:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æœ‰æ—¶åœ¨ç»“æ„ä¸­åŒ…è£…æšä¸¾ä»¥éšè—å®ç°ç»†èŠ‚æ˜¯ä¸ªå¥½ä¸»æ„:</p>
<pre><small></small><div></div><code class="hljs language-csharp"><span class="hljs-function">pub <span class="hljs-keyword">struct</span> <span class="hljs-title">Foo</span>(<span class="hljs-params">FooImpl</span>)</span>; <span class="hljs-comment">// FooImpl is private</span>

<span class="hljs-built_in">enum</span> FooImpl {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p class="cyxy-trs-source cyxy-trs-source-ted">Also, when an enum variant has multiple fields, itâ€™s usually better to put them in a separate struct, so itâ€™s possible to make the fields private or make the struct <code>non_exhaustive</code>:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å¦å¤–ï¼Œå½“ enum å˜é‡æœ‰å¤šä¸ªå­—æ®µæ—¶ï¼Œé€šå¸¸æœ€å¥½å°†å®ƒä»¬æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„ç»“æ„ä¸­ï¼Œå› æ­¤å¯ä»¥å°†å­—æ®µè®¾ç½®ä¸º private æˆ–è€…ä½¿è¯¥ç»“æ„éè¯¦å°½æ— é—:</p>
<pre><small></small><div></div><code class="hljs language-rust"><span class="hljs-comment">// Instead of this:</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Foo</span> {
    Variant {
        field: <span class="hljs-type">i32</span>,
        other_field: <span class="hljs-type">bool</span>,
    }
}

<span class="hljs-comment">// do this:</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Foo</span> {
    <span class="hljs-title function_ invoke__">Variant</span>(FooVariant),
}
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">FooVariant</span> {
    field: <span class="hljs-type">i32</span>,
    other_field: <span class="hljs-type">bool</span>,
}
</code></pre>
<h3 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23macros)Macros"></sup><a class="header-link" href="#id-%5B%5D(%23macros)Macros"></a><p><a class="header-link" href="#id-%5B%5D(%23macros)Macros"></a><a href="#macros"></a>Macros</p></h3><h3 class="cyxy-trs-source cyxy-trs-target">å®</h3>
<p class="cyxy-trs-source cyxy-trs-source-ted"><wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_34" class="wdautohl_ZGVjbGFyYXRpdmU_">Declarative</wdautohl-customtag> macros (the ones that are declared with <code>macro_rules!</code>) behave more like local variables within a function than like items in some regards. For example, they can be shadowed, they have to be declared before they can be used, and they donâ€™t need to be explicitly imported in child modules <sup class="footnote">[<a href="#_footnotedef_2" title="View footnote.">2</a>]</sup>.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">å£°æ˜æ€§å®(ç”¨å® _ è§„åˆ™å£°æ˜çš„å®!)åœ¨æŸäº›æ–¹é¢ï¼Œå®ƒä»¬æ›´åƒæ˜¯å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ï¼Œè€Œä¸æ˜¯ç±»ä¼¼çš„é¡¹ã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬å¯ä»¥è¢«éšè—ï¼Œåœ¨ä½¿ç”¨å®ƒä»¬ä¹‹å‰å¿…é¡»å£°æ˜å®ƒä»¬ï¼Œå¹¶ä¸”å®ƒä»¬ä¸éœ€è¦åœ¨å­æ¨¡å—[2]ä¸­æ˜¾å¼å¯¼å…¥ã€‚</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">And, they canâ€™t be declared public. The <code>#[macro_export]</code> attribute can be added to a macro, which exports it publicly at the crate root. This can be <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_35" class="wdautohl_dW5kZXNpcmFibGU_">undesirable</wdautohl-customtag>, however, if itâ€™s not supposed to be part of the public API; there is no equivalent of <code>pub(crate)</code> for macros.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">è€Œä¸”ï¼Œå®ƒä»¬ä¸èƒ½è¢«å…¬å¼€ã€‚å¯ä»¥å°† # [ macro _ export ]å±æ€§æ·»åŠ åˆ°å®ä¸­ï¼Œè¯¥å®åœ¨æ¿æ¡ç®±æ ¹ç›®å½•ä¸­å…¬å¼€å¯¼å‡ºå®ƒã€‚ä½†æ˜¯ï¼Œå¦‚æœå®ƒä¸åº”è¯¥æ˜¯å…¬å…± API çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆè¿™å¯èƒ½æ˜¯ä¸å¯å–çš„; å®æ²¡æœ‰ç±»ä¼¼äº pub (crate)çš„ä¸œè¥¿ã€‚</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">One workaround for this is to put our macros in a module and <wdautohl-customtag style="font-weight:bold;color:red;font-size:inherit;display:inline;" id="wdautohl_id_36" class="wdautohl_YW5ub3RhdGU_">annotate</wdautohl-customtag> the module with <code>#[macro_use]</code>. The module should be the <em>first module declaration</em> in the crate root. This ensures that the macros can be used everywhere in our crate, but not outside of the crate. Not the most elegant solution, but it works.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯å°†æˆ‘ä»¬çš„å®æ”¾åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œå¹¶ç”¨ # [ macro _ use ]æ³¨é‡Šè¯¥æ¨¡å—ã€‚æ¨¡å—åº”è¯¥æ˜¯æ¿æ¡ç®±æ ¹ä¸­çš„ç¬¬ä¸€ä¸ªæ¨¡å—å£°æ˜ã€‚è¿™ç¡®ä¿äº†å®å¯ä»¥åœ¨æˆ‘ä»¬çš„æ¿æ¡ç®±ä¸­çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œä½†ä¸èƒ½åœ¨æ¿æ¡ç®±å¤–ä½¿ç”¨ã€‚è™½ç„¶ä¸æ˜¯æœ€ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒç¡®å®æœ‰æ•ˆã€‚</p>
<h2 class="cyxy-trs-source cyxy-trs-source-ted"><sup class="fake-head" id="id-%5B%5D(%23why-are-modules-declared-explicitly)Why%20are%20modules%20declared%20explicitly%3F"></sup><a class="header-link" href="#id-%5B%5D(%23why-are-modules-declared-explicitly)Why%20are%20modules%20declared%20explicitly%3F"></a><p><a class="header-link" href="#id-%5B%5D(%23why-are-modules-declared-explicitly)Why%20are%20modules%20declared%20explicitly%3F"></a><a href="#why-are-modules-declared-explicitly"></a>Why are modules declared explicitly?</p></h2><h2 class="cyxy-trs-source cyxy-trs-target" contenteditable="true">ä¸ºä»€ä¹ˆè¦æ˜¾å¼å£°æ˜æ¨¡å—ï¼Ÿ</h2>
<p class="cyxy-trs-source cyxy-trs-source-ted">I promised to explain why modules have to be declared explicitly. There are a few reasons:</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æˆ‘æ‰¿è¯ºè¦è§£é‡Šä¸ºä»€ä¹ˆå¿…é¡»æ˜ç¡®å£°æ˜æ¨¡å—ï¼ŒåŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹:</p>
<ol>
<li><p class="cyxy-trs-source cyxy-trs-source-ted">With the [<code>&lt;a target="_blank" href="https://doc.rust-lang.org/reference/items/modules.html#the-path-attribute"&gt;path]</code> attribute, a module can be located in a different directory, or have a different name than the file.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">ä½¿ç”¨[ &lt; a target = " _ blank" href = " https://doc.rust-lang. org/reference/items/modules. html # the-path-attribute" &gt; path ]å±æ€§ï¼Œä¸€ä¸ªæ¨¡å—å¯ä»¥ä½äºä¸åŒçš„ç›®å½•ä¸­ï¼Œæˆ–è€…æ‹¥æœ‰ä¸æ–‡ä»¶ä¸åŒçš„åç§°ã€‚</p></li>
<li><p class="cyxy-trs-source cyxy-trs-source-ted">Module declarations can have a visibility, e.g. <code>pub(crate) mod foo;</code></p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æ¨¡å—å£°æ˜å¯ä»¥å…·æœ‰å¯è§æ€§ï¼Œä¾‹å¦‚ pub (crate) mod foo;</p></li>
<li><p class="cyxy-trs-source cyxy-trs-source-ted">Sometimes there are files which you donâ€™t want to include in the module tree.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">æœ‰æ—¶ï¼Œæ‚¨ä¸å¸Œæœ›åœ¨æ¨¡å—æ ‘ä¸­åŒ…å«æŸäº›æ–‡ä»¶ã€‚</p>
<p class="cyxy-trs-source cyxy-trs-source-ted">For example, a crate with both a library and a binary target usually contains a <code>lib.rs</code> file for the library and a <code>main.rs</code> file for the binary. Submodules are stored in the same directory, but some modules are only needed by the library, and some only by the binary. By specifying the modules explicitly, you can include only the necessary modules in each file.</p><p class="cyxy-trs-source cyxy-trs-target" contenteditable="true">ä¾‹å¦‚ï¼ŒåŒæ—¶å…·æœ‰åº“å’ŒäºŒè¿›åˆ¶ç›®æ ‡çš„æ¿æ¡ç®±é€šå¸¸åŒ…å«åº“çš„ lib.rs æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ main.rs æ–‡ä»¶ã€‚å­æ¨¡å—å­˜å‚¨åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ï¼Œä½†æ˜¯æœ‰äº›æ¨¡å—ä»…ä»…æ˜¯åº“æ‰€éœ€è¦çš„ï¼Œæœ‰äº›ä»…ä»…æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶æ‰€éœ€è¦çš„ã€‚é€šè¿‡æ˜¾å¼åœ°æŒ‡å®šæ¨¡å—ï¼Œæ‚¨å¯ä»¥åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­åªåŒ…å«å¿…è¦çš„æ¨¡å—ã€‚</p></li>
</ol>
<p class="cyxy-trs-source cyxy-trs-source-ted">Until next time!</p><p class="cyxy-trs-source cyxy-trs-target">ä¸‹æ¬¡è§ï¼</p>